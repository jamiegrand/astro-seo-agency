# {{PROJECT_NAME}} - Claude Code Instructions

> Astro SEO Agency Plugin v3.0.0
> Last configured: {{DATE}}

---

## Quick Start

```bash
/start              # Begin session with data-driven priorities
/fix-next           # Fix highest-impact issue
/feature "desc"     # Build new feature
/astro-check        # Query project info via MCP
/pause              # Save and exit
/resume             # Continue tomorrow
```

---

## Project Context

| Field | Value |
|-------|-------|
| **Framework** | Astro {{ASTRO_VERSION}} |
| **Site URL** | {{SITE_URL}} |
| **Output Mode** | {{OUTPUT_MODE}} |
| **GA Property** | {{GA_PROPERTY_ID}} |
| **GSC Property** | {{GSC_SITE_URL}} |
| **Repository** | {{GITHUB_REPO}} |

---

## Astro MCP Integration

This project uses Astro MCP servers for enhanced AI assistance.

### Astro Docs MCP (Documentation)
- **Status:** {{ASTRO_DOCS_MCP_STATUS}}
- **URL:** https://mcp.docs.astro.build/mcp
- **Purpose:** Real-time access to official Astro documentation

**Setup (if not configured):**
```json
{
  "mcpServers": {
    "astro-docs": {
      "command": "npx",
      "args": ["-y", "mcp-remote", "https://mcp.docs.astro.build/mcp"]
    }
  }
}
```

### astro-mcp Integration (Project Awareness)
- **Status:** {{ASTRO_MCP_STATUS}}
- **URL:** http://localhost:4321/__mcp/sse (when dev server running)
- **Purpose:** Routes, configuration, content locations

**Setup (if not installed):**
```bash
npx astro add astro-mcp
```

### MCP Tools Available

| Tool | Server | Purpose |
|------|--------|---------|
| `search_astro_docs` | Astro Docs | Search documentation |
| `get-astro-config` | astro-mcp | Project configuration |
| `list-astro-routes` | astro-mcp | All routes |
| `get-astro-server-address` | astro-mcp | Server status |
| `get-integration-docs` | astro-mcp | Integration help |

### When MCP Is Used

| Command | Astro Docs | astro-mcp |
|---------|------------|-----------|
| `/start` | Deprecation check | Project health |
| `/fix-next` | Best practices | Affected routes |
| `/feature` | Implementation patterns | Route conflicts |
| `/audit` | Current recommendations | Route validation |
| `/seo-wins` | - | URL to file mapping |
| `/content-roi` | - | Content locations |
| `/deploy-check` | Deploy guidance | Config validation |

---

## The 3-Layer Architecture

This project follows a strict separation of concerns:

```
┌─────────────────────────────────────────────────────────────────┐
│  LAYER 1: DATA (What to display)                                │
│  └── src/data/*.js, src/content/**/*.md                         │
│      Products, services, locations, blog posts, FAQs            │
│      → CHANGE THIS for content updates                          │
├─────────────────────────────────────────────────────────────────┤
│  LAYER 2: COMPONENTS (How to display)                           │
│  └── src/components/*.astro, src/layouts/*.astro                │
│      Reusable UI, page templates                                │
│      → CHANGE THIS only for new features or fixes               │
├─────────────────────────────────────────────────────────────────┤
│  LAYER 3: STYLES (Visual presentation)                          │
│  └── src/styles/global.css, Tailwind utilities                  │
│      Colors, typography, spacing                                │
│      → CHANGE THIS for design updates                           │
└─────────────────────────────────────────────────────────────────┘
```

**Golden Rule:** Prefer data changes over code changes. Most updates should modify Layer 1, not Layer 2.

---

## Content Structure

### Content Collections
{{#if CONTENT_COLLECTIONS}}
| Collection | Location | Items |
|------------|----------|-------|
{{#each CONTENT_COLLECTIONS}}
| {{name}} | src/content/{{name}}/ | {{count}} |
{{/each}}
{{else}}
No content collections detected. Consider using them for blog posts, docs, etc.
{{/if}}

### Data Files
{{#if DATA_FILES}}
| File | Location | Generates |
|------|----------|-----------|
{{#each DATA_FILES}}
| {{name}} | src/data/{{file}} | {{routes}} |
{{/each}}
{{else}}
No data files detected in src/data/.
{{/if}}

### Route Summary
| Type | Count |
|------|-------|
| Static Pages | {{STATIC_ROUTES}} |
| Dynamic Routes | {{DYNAMIC_ROUTES}} |
| API Endpoints | {{API_ROUTES}} |
| **Total** | **{{TOTAL_ROUTES}}** |

---

## Astro Zone Ownership

When building features, files are organized into zones to prevent conflicts:

```yaml
ALPHA (Foundation):
  - src/layouts/
  - src/styles/
  - src/config/
  - astro.config.mjs
  
BETA (Components & Data):
  - src/components/
  - src/data/
  - src/content/
  - src/utils/
  
GAMMA (Pages & Integration):
  - src/pages/
  - public/
  - tests/
```

**For feature development:** Each zone can be worked on without conflicts. The `/feature` command respects these boundaries.

---

## MCP Tools Available

### Always Available
- **Astro Docs MCP** - Real-time Astro documentation
- **Sequential Thinking** - Complex problem solving

### When Dev Server Running (`npm run dev`)
- **astro-mcp** - Project configuration, routes, integrations

{{#if GA_CONFIGURED}}
### Google Analytics
- Query traffic, behavior, conversions
- Property ID: {{GA_PROPERTY_ID}}
{{/if}}

{{#if GSC_CONFIGURED}}
### Google Search Console  
- Query rankings, impressions, CTR
- Find quick wins (position 4-15)
- Site: {{GSC_SITE_URL}}
{{/if}}

{{#if GITHUB_CONFIGURED}}
### GitHub
- Create/manage issues
- Commit changes
- Create PRs
{{/if}}

---

## Commands Reference

### Daily Workflow
| Command | Description |
|---------|-------------|
| `/start` | Query analytics + astro-mcp, show priorities |
| `/fix-next` | Auto-select and implement highest-impact issue |
| `/status` | Show current state and progress |
| `/pause` | Save session, create handoff doc |
| `/resume` | Restore session from handoff |

### SEO & Content
| Command | Description |
|---------|-------------|
| `/seo-wins` | Find GSC quick wins with file locations |
| `/content-roi` | Analyze content performance by source |
| `/impact [#]` | Measure before/after effect of changes |
| `/audit [type]` | Run SEO/a11y/perf/astro audit |

### Astro Tools
| Command | Description |
|---------|-------------|
| `/astro-check` | Full project report via MCP |
| `/astro-check routes` | List all routes |
| `/astro-check docs "query"` | Search Astro documentation |

### Feature Development
| Command | Description |
|---------|-------------|
| `/feature "description"` | Plan and build new feature |
| `/deploy-check` | Pre-deployment verification |

### Help
| Command | Description |
|---------|-------------|
| `/help` | Show all commands |

---

## Operating Principles

### 1. Consult Astro Docs First
Before any Astro-related code change, search the Astro Docs MCP for current best practices.

### 2. Check Project State
Use astro-mcp to understand routes, config, and content locations before making changes.

### 3. Read Before Writing
Never modify code without understanding existing patterns and constraints.

### 4. Data Over Code
Most changes should modify data files (Layer 1), not components (Layer 2).

### 5. Self-Annealing Loop
```
Error → Search Astro docs → Diagnose → Fix → Test → System stronger
```

### 6. Atomic Commits
One logical change per commit. Perfect bisect. Surgical rollback.

---

## Quality Gates

Every change must pass:
- [ ] TypeScript compiles (`npm run astro check`)
- [ ] Build succeeds (`npm run build`)
- [ ] Routes verified (via astro-mcp if available)
- [ ] No console errors in dev

---

## File Priorities

When starting work, read files in this order:

1. **AI-INFO.md** - Full architecture reference (if exists)
2. **HANDOFF.md** - Session state (if resuming)
3. **Query astro-mcp** - Current routes, config (if dev server running)
4. **Relevant data files** - `src/data/*.js`
5. **Affected components** - Only if modifying

---

## Issue Tracking

{{#if GITHUB_ISSUES}}
### GitHub Issues
- Managed via GitHub MCP
- Labels: `priority:*`, `phase:*`, `type:*`, `astro`
- Claude can create/update/close issues
{{else}}
### Markdown Tracker
- File: `AUDIT_TRACKER.md`
- Format: `### [ ] Issue #X: Title`
- Update after completing issues
{{/if}}

---

## Session Persistence

### Pausing Work
```
/pause
```
Creates `.planning/HANDOFF.md` with:
- Current task and progress
- Project state snapshot (from astro-mcp)
- Astro docs consulted
- What's done, what's next

### Resuming Work
```
/resume
```
Reads HANDOFF.md, restores full context including Astro docs findings.

---

## Common Tasks

### Add a New Page
```
1. Run `/astro-check routes` to check for conflicts
2. Search Astro docs: `/astro-check docs "pages"`
3. Create src/pages/[page-name].astro
4. Use existing page as template
5. Verify route: `/astro-check routes [name]`
```

### Add a Blog Post
```
1. Create src/content/blog/[slug].md
2. Include required frontmatter (check content/config.ts)
3. Write content in Markdown
4. Images go in src/assets/blog/
```

### Add a Product/Service
```
1. Edit src/data/products.js or services.js
2. Follow existing schema exactly
3. Add image to public/[type]/
4. Verify route generated: `/astro-check routes`
```

### Update Astro Patterns
```
1. Search docs: `/astro-check docs "[topic]"`
2. Review current recommendation
3. Apply to codebase
4. Verify build passes
```

---

## Emergency Procedures

### Build Failing
```bash
npm run astro check  # Find TypeScript errors

# Search Astro docs for error
/astro-check docs "[error message]"
```

### Agent Stuck
```
/pause
# Start fresh session
/resume
```

### Need to Rollback
```bash
git log --oneline -10
git revert HEAD
```

### MCP Not Working
```
# Astro Docs MCP - check config, restart editor
# astro-mcp - ensure dev server running: npm run dev
```

---

## Project-Specific Notes

{{PROJECT_NOTES}}

---

*Generated by Astro SEO Agency Plugin v3.0.0*
*Full documentation: AI-INFO.md*
*MCP Integration: prompts/astro-mcp-integration.md*
